graph LR
    subgraph Frontend[用户浏览器 Frontend]
        direction LR
        UI[Next.js统一搜索入口<br>搜索结果页Web/LLM/KB <br> shadcn/ui, React Context]
    end

    subgraph Backend[Next.js 服务器 Backend]
        direction TB
        Actions[Server Actions]

        subgraph SearchActions[搜索 Actions]
            KbAction[performKbSearchAction]
            WebAction[performWebSearchAction]
            LlmAction[performLlmSearchAction]
        end

        subgraph KbManagement[知识库管理 Actions]
            KbMgmt[创建/列表/更新/删除 KB]
        end

        Actions --> KbAction
        Actions --> WebAction
        Actions --> LlmAction
        Actions --> KbMgmt
    end

    subgraph DatabaseStorage[数据库 & 存储]
        direction TB
        PG_Structured[PostgreSQL结构化数据Prisma]
        PG_Vector[PostgreSQL <br> pgvector <br> 向量嵌入]
        MinIO[MinIO/文件存储/知识库文档]
        Redis[Redis<br>缓存/会话]
    end

    subgraph ExternalServices[外部服务 / API]
        direction TB
        EmbeddingAPI[Embedding API <br> e.g., OpenAI]
        WebAPIs[Web 搜索 API <br> Tavily, Jina, DDG]
        LLMAPIs[LLM API <br> Gemini, GPT, DeepSeek, Proxy?]
        OAuth[OAuth 提供商 <br> Google, GitHub]
    end

    UI -->|1.用户交互输入查询, 选择KB/模型/引擎, 点击块| Actions
    Actions -->|8.返回结果/状态| UI

    KbAction -->|2.生成 Embedding| EmbeddingAPI
    KbAction -->|3.搜索相似块| PG_Vector
    PG_Vector -->|4.返回文本块| KbAction

    WebAction -->|5.调用| WebAPIs
    LlmAction -->|6.调用| LLMAPIs

    KbMgmt -->|7.CRUD 操作| PG_Structured
    KbMgmt -->|文件操作| MinIO

    %% 一些隐含的连接
    Actions --> 读取配置 --> 环境变量.env
    UI --> 认证检查 --> NextAuth --> 使用 --> OAuth/DB

    style Frontend fill:#D1E8FF,stroke:#333
    style Backend fill:#E0E0E0,stroke:#333
    style DatabaseStorage fill:#FFF2CC,stroke:#333
    style ExternalServices fill:#FFD1DC,stroke:#333