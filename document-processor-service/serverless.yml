service: document-processor-service

plugins:
  - serverless-offline

provider:
  name: aws
  runtime: nodejs18.x
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'ap-northeast-1'}
  environment:
    STORAGE_PATH: /tmp/storage
    REDIS_HOST: ${env:REDIS_HOST}
    REDIS_PORT: ${env:REDIS_PORT}
    REDIS_PASSWORD: ${env:REDIS_PASSWORD}
    REDIS_DB: ${env:REDIS_DB}
    QUEUE_PREFIX: ${env:QUEUE_PREFIX}
    LOG_LEVEL: ${env:LOG_LEVEL}

custom:
  serverless-offline:
    httpPort: 5001
    noPrependStageInUrl: true
    lambdaPort: 5002

functions:
  uploadDocument:
    handler: dist/serverless.handleDocumentUpload
    events:
      - http:
          path: /documents/upload
          method: post
          cors: true
    timeout: 30
    memorySize: 1024

  getDocumentStatus:
    handler: dist/serverless.handleDocumentStatus
    events:
      - http:
          path: /documents/{documentId}/status
          method: get
          cors: true
    timeout: 10
    memorySize: 256

  getDocumentContent:
    handler: dist/serverless.handleDocumentContent
    events:
      - http:
          path: /documents/{documentId}/content
          method: get
          cors: true
    timeout: 10
    memorySize: 256

  getDocumentChunks:
    handler: dist/serverless.handleDocumentChunks
    events:
      - http:
          path: /documents/{documentId}/chunks
          method: get
          cors: true
    timeout: 10
    memorySize: 256

package:
  patterns:
    - '!node_modules/.cache/**'
    - '!test/**'
    - '!src/**'
    - 'dist/**'
    - 'node_modules/**'
    - 'package.json'
    - 'package-lock.json'
    - 'yarn.lock' 